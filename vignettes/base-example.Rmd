---
title: "base-example"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{base-example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(tidyverse)
library(janitor)
library(tsrecipes)
library(recipes)
```

```{r}
tsdb <- tsrecipes::prices
```


```{r}
prepped <- recipe(tsdb) %>%
  step_dct(ts, k = 8, preserve = TRUE) %>%
  prep()


tsdb_dct <- bake(prepped, tsdb)
tsdb_dct
```

```{r}
indices <- prepped$steps[[1]]$coefs$ts

reconstruct <- tsdb_dct %>%
  rowwise(id, class, ts) %>%
  summarise(reconts = list(c(c_across()))) %>%
  rowwise() %>%
  mutate(
    reconts = list(invert(reconts, indices, 60)),
    n = list(1:60)
  ) %>%
  ungroup()
```

```{r}
reconstruct %>%
  sample_n(5) %>%
  unnest(c(ts, reconts, n)) %>%
  ggplot(aes(n)) +
  geom_line(aes(y = ts, group = id), color = "red") +
  geom_line(aes(y = reconts, group = id), color = "blue") +
  facet_wrap(~id)
```



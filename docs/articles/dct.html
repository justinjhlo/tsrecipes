<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>dct • tsrecipes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="dct">
<meta property="og:description" content="tsrecipes">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tsrecipes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/base-example.html">base-example</a>
    </li>
    <li>
      <a href="../articles/benchmarking-dct.html">benchmarking-dct</a>
    </li>
    <li>
      <a href="../articles/dct.html">dct</a>
    </li>
    <li>
      <a href="../articles/dtw2.html">dtw2</a>
    </li>
    <li>
      <a href="../articles/tune.html">tune</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tmastny/tsrecipes/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="dct_files/header-attrs-2.3/header-attrs.js"></script><script src="dct_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>dct</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tmastny/tsrecipes/blob/master/vignettes/dct.Rmd"><code>vignettes/dct.Rmd</code></a></small>
      <div class="hidden name"><code>dct.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The discrete cosine transform (DCT) can provide significant dimensionality reduction for time series, improving accuracy in time series classification and clustering. That’s the topic my previous <a href="">post</a>.</p>
<p>Besides being a useful tool, DCT is fascinating in it’s own right. It is a <a href="https://en.wikipedia.org/wiki/Transform_coding#:~:text=Transform%20coding%20is%20a%20type,audio%20signals%20or%20photographic%20images.">perfectly reversible</a> transform that provides a principled way to remove irrelevant information.</p>
<p>How is this possible, and why does it work so well for time series? I’ll try to answer this by</p>
<ol style="list-style-type: decimal">
<li>representing time series as combinations of different time series</li>
<li>explaining how the discrete cosine transform is a combination of cosine waves of varying strength and frequency</li>
<li>demonstrating that the <em>strength</em> and <em>frequency</em> of cosine waves are effective dimensionality reduction criteria</li>
</ol>
<p>Lastly, I’ll share some resources on data compression: the field of study where DCT originated, and why it has fundamental connections to machine learning.</p>
</div>
<div id="time-series-as-combinations-of-components" class="section level2">
<h2 class="hasAnchor">
<a href="#time-series-as-combinations-of-components" class="anchor"></a>Time series as combinations of components</h2>
<p>A common tool in time series analysis is <a href="https://otexts.com/fpp3/decomposition.html">time series decomposition</a>, where a series is decomposed into the trend, seasonal, and random components. These components can be added or multiplied together to reconstruct the original time series, depending on the model.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fpp3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tsrecipes</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)

<span class="no">us_retail_employment</span> <span class="kw">&lt;-</span> <span class="kw pkg">fpp3</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/fpp3/man/us_employment.html">us_employment</a></span>  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">year</span>(<span class="no">Month</span>) <span class="kw">&gt;=</span> <span class="fl">1990</span>, <span class="no">Title</span> <span class="kw">==</span> <span class="st">"Retail Trade"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">Series_ID</span>)

<span class="no">us_retail_employment</span> <span class="kw">%&gt;%</span>
  <span class="fu">model</span>(<span class="fu">classical_decomposition</span>(<span class="no">Employed</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"additive"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">components</span>() <span class="kw">%&gt;%</span>
  <span class="fu">autoplot</span>() +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="kw">NULL</span>)</pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Another way to think about decomposition is by frequency. Think of frequency as the waves and wiggles in the time series. Both the sharp, quick wiggles (high frequency) and wide, slow ones (low frequency).</p>
<p>For example:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ts</span> <span class="kw">&lt;-</span> <span class="no">ethanol</span>$<span class="no">ts</span><span class="kw">[[</span><span class="fl">1</span>]]
<span class="no">ts_dct</span> <span class="kw">&lt;-</span> <span class="fu">tibble</span>(
  <span class="kw">ts</span> <span class="kw">=</span> <span class="no">ts</span>,
  <span class="kw">dct</span> <span class="kw">=</span> <span class="fu">fdct</span>(<span class="no">ts</span>),
  <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ts</span>)
)</pre></body></html></div>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ts_recon</span> <span class="kw">&lt;-</span> <span class="no">ts_dct</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">dct_lf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">dct</span>) <span class="kw">&lt;=</span> <span class="fl">20</span>, <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_lf</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_lf</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">dct_hf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu">between</span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">dct</span>), <span class="fl">20</span>, <span class="fl">1751</span>), <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_hf</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_hf</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  )

<span class="no">ts_recon</span> <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ts</span>, <span class="no">ts_hf</span>, <span class="no">ts_lf</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">n</span>, <span class="no">value</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">name</span>))</pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>the original time series (in red) is decomposed into a low-frequency series (blue) and a high-frequency series (green). And like in classical time series decomposition, we can add the components back together to exactly reconstruct the series.</p>
<p>You can also think of the low-frequency component as time series smoothing, like the trend in classical decomposition (or a simple moving average). It’s not as useful as other smoothing techniques, in general, because it a little too wavy. Note the blue waves that randomly appear in the flat section from 0 to 500.</p>
<p>The discrete cosine feature is what makes all this possible. In the next section, I’ll explain how it really works.</p>
</div>
<div id="discrete-cosine-transform-cosine-combinations" class="section level2">
<h2 class="hasAnchor">
<a href="#discrete-cosine-transform-cosine-combinations" class="anchor"></a>Discrete cosine transform: cosine combinations</h2>
<p>To accomplish the frequency decomposition, we need basic units of frequency, like the recurring units of time (week, month, year) in seasonal decomposition.</p>
<p>For the discrete cosine transform, this is a sequence, the same length as the time series, of cosine waves that uniformly increase in frequency.</p>
<p>It’s easier to imagine by way of examples. Below are 6 low-frequency waves part of the 1751 cosine waves needed to represent the red time series (of length 1751) in the previous section.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">cosine</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">i</span>, <span class="no">j</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">60</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(<span class="no">pi</span> / <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">j</span>) * <span class="no">i</span> * (<span class="no">j</span> + <span class="fl">1</span>/<span class="fl">2</span>))
}</pre></body></html></div>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">fib</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">13</span>)

<span class="no">cosine1</span> <span class="kw">&lt;-</span> <span class="no">ts_recon</span> <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">cosine</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu">cosine</span>(<span class="no">n</span>, <span class="kw">j</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">1751</span>)),
    <span class="kw">cosine_scale</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">dct</span> * <span class="no">cosine</span>),
    <span class="kw">i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">1</span>:<span class="fl">1751</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">n</span> <span class="kw">%in%</span> <span class="no">fib</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">i</span>, <span class="no">cosine</span>, <span class="no">cosine_scale</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">i</span>, <span class="no">cosine</span>)) +
  <span class="fu">facet_wrap</span>(~<span class="no">n</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>)

<span class="no">cosine1</span></pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Frequency is only one component: we also need the <em>strength</em> (or amplitude) of the wave. The strength of a cosine wave is typically called the DCT coefficient. Calculating the coefficients is the real essence of the discrete cosine transform. For any time series of length 1751, the fundamental cosine wave units are the same; what changes are the coefficients.</p>
<p>Below are the cosine waves for the red time series.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">cosine1_scaled</span> <span class="kw">&lt;-</span> <span class="no">ts_recon</span> <span class="kw">%&gt;%</span>
  <span class="fu">rowwise</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">cosine</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu">cosine</span>(<span class="no">n</span>, <span class="kw">j</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">1751</span>)),
    <span class="kw">cosine_scale</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">dct</span> * <span class="no">cosine</span>),
    <span class="kw">i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">1</span>:<span class="fl">1751</span>)
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">n</span> <span class="kw">%in%</span> <span class="no">fib</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">i</span>, <span class="no">cosine</span>, <span class="no">cosine_scale</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">i</span>, <span class="no">cosine_scale</span>)) +
  <span class="fu">facet_wrap</span>(~<span class="no">n</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="kw">NULL</span>)

<span class="no">cosine1_scaled</span></pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Let’s think about the how the strength might change with frequency. With this small sample of waves, it’s hard to get a sense of the changes, so let’s look back at the decomposition.</p>
<p>The blue, low-frequency component ranges from -1 to 2, while the high frequency red component oscillates mostly around zero, with the largest wave measuring about 1 from peak to trough.</p>
<p>Plotting the strength of the wave versus the frequency, the strength appears to decrease towards zero as the frequency increases.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">ts_recon</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="no">n</span>, <span class="no">dct</span>)) +
  <span class="fu">geom_line</span>() +
  <span class="fu">scale_y_continuous</span>(<span class="kw">trans</span> <span class="kw">=</span> <span class="st">"atanh"</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"frequency"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"strength"</span>)</pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>If the strength of some of these waves are so small, do we really need them to reconstruct the time series?</p>
</div>
<div id="time-series-dimensionality-reduction" class="section level2">
<h2 class="hasAnchor">
<a href="#time-series-dimensionality-reduction" class="anchor"></a>Time series dimensionality reduction</h2>
<p>Since the high-frequency waves have around zero strength, let’s get rid of them. I’ll set the terms equal to zero, and attempt to reconstruct the red time series:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">ts_recon</span> <span class="kw">&lt;-</span> <span class="no">ts_dct</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">dct_20</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">dct</span>) <span class="kw">&lt;=</span> <span class="fl">20</span>, <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_20</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_20</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">dct_20_40</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu">between</span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">dct</span>), <span class="fl">20</span>, <span class="fl">40</span>), <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_20_40</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_20_40</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">dct_40</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">dct</span>) <span class="kw">&lt;=</span> <span class="fl">40</span>, <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_40</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_40</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  )</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ts_recon</span> <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ts</span>, <span class="no">ts_40</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">n</span>, <span class="no">value</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">name</span>))</pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>That’s a pretty decent reconstruction. How many terms did I set to zero? <em>1711</em>. I’ve encoded a huge amount of the information in only <strong>40</strong> dimensions!</p>
<p>This is the real power of the discrete cosine transform.</p>
<p>But so far we’ve only reduced dimensions by the frequency. We can also cut dimensions based on the strength of the coefficients. In the following example, I set all the coefficients below <code><a href="https://rdrr.io/r/base/MathFun.html">abs(15)</a></code> to 0. The result is <em>33</em> dimensions.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">ts_recon_low_dim</span> <span class="kw">&lt;-</span> <span class="no">ts_recon</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">dct_33</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">dct</span>) <span class="kw">&gt;=</span> <span class="fl">15</span>, <span class="no">dct_40</span>, <span class="fl">0</span>),
    <span class="kw">ts_33</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_33</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  )</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">ts_recon_low_dim</span> <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ts</span>, <span class="no">ts_33</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">n</span>, <span class="no">value</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">name</span>))</pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Overall, still pretty good, but 0-500 and &gt;1500 look a little too wiggly. Both reconstructions have pretty similar mean squared error to the original red time series.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">ts_recon_low_dim</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">ts</span>, <span class="no">ts_33</span>, <span class="no">ts_40</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">proxy</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html">dist</a></span>()
<span class="co">#&gt;              ts     ts_33</span>
<span class="co">#&gt; ts_33 2.3629005          </span>
<span class="co">#&gt; ts_40 2.2792833 0.6230297</span></pre></body></html></div>
<div id="how-much-reduction-is-possible" class="section level3">
<h3 class="hasAnchor">
<a href="#how-much-reduction-is-possible" class="anchor"></a>How much reduction is possible?</h3>
<p>In the last example, the reconstruction was reasonably accurate using only 2% of the original dimensions! How much can you expect to reduce in general? And which frequencies should you remove?</p>
<p>Unfortunately, there’s no way to now ahead of time. In data compression, our understanding of human <a href="http://www.svcl.ucsd.edu/courses/ece161c/handouts/DCT.pdf">visual</a> and auditory perception determines which features have little impact on the reconstruction quality. For example, the average human ear hears sound in the <a href="https://en.wikipedia.org/wiki/Psychoacoustics">20 Hz to 20 kHz</a> frequency ranges, so we can safely remove those waves no matter what.</p>
<p>With the last time series, we first excluded the high-frequency components, but in some time series high-frequencies are the most important features.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ts_dct2</span> <span class="kw">&lt;-</span> <span class="fu">tibble</span>(
  <span class="kw">ts</span> <span class="kw">=</span> <span class="no">prices</span>$<span class="no">ts</span><span class="kw">[[</span><span class="fl">1</span>]],
  <span class="kw">dct</span> <span class="kw">=</span> <span class="fu">fdct</span>(<span class="no">ts</span>),
  <span class="kw">n</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ts</span>)
)</pre></body></html></div>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">ts_recon2</span> <span class="kw">&lt;-</span> <span class="no">ts_dct2</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">dct_lf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">dct</span>) <span class="kw">&lt;=</span> <span class="fl">30</span>, <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_lf</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_lf</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">dct_hf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu">between</span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">dct</span>), <span class="fl">31</span>, <span class="fl">60</span>), <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_hf</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_hf</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">dct_str</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">dct</span>) <span class="kw">&gt;</span> <span class="fl">6.15</span>, <span class="no">dct</span>, <span class="fl">0</span>),
    <span class="kw">ts_str</span> <span class="kw">=</span> <span class="kw pkg">dtt</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtt/man/dtt.html">dct</a></span>(<span class="no">dct_str</span>, <span class="kw">inverted</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  )</pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">ts_recon2</span> <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ts</span>, <span class="no">ts_hf</span>, <span class="no">ts_lf</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>() +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">n</span>, <span class="no">value</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">name</span>))</pre></body></html></div>
<p><img src="dct_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>In this time series of length 60, I chose the top 30 low frequency and high frequency coefficients. The blue, low frequency reconstruction doesn’t capture enough of the variation. As we’ll see below the high-frequency reconstruct has much lower mean squared error.</p>
<p>Another option is the top 30 largest coefficients, which cuts the error by half!</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">ts_recon2</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">ts</span>, <span class="no">ts_hf</span>, <span class="no">ts_lf</span>, <span class="no">ts_str</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>() <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">proxy</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/proxy/man/dist.html">dist</a></span>()
<span class="co">#&gt;              ts    ts_hf    ts_lf</span>
<span class="co">#&gt; ts_hf  6.413039                  </span>
<span class="co">#&gt; ts_lf  7.437955 9.820909         </span>
<span class="co">#&gt; ts_str 3.663415 6.389416 7.458258</span></pre></body></html></div>
<p>And in general, it is typically better to chose the largest coefficients, rather than low or high frequency ones. Even this isn’t a silver bullet: you still have to decide how many of the largest coefficients you want to include.</p>
<p>Arbitrary times series have no guidelines like the ones sensory perception provides in data compression. You have to either use your judgment, or decide using some selection procedure.</p>
</div>
<div id="dimensionality-reduction-for-time-series-classification" class="section level3">
<h3 class="hasAnchor">
<a href="#dimensionality-reduction-for-time-series-classification" class="anchor"></a>Dimensionality reduction for time series classification</h3>
<p>All of the previous material has been on dimensionality reduction for a single time series<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>While I think it’s useful in understanding what the discrete cosine is and does, doing dimensionality reduction on a <em>set</em> of time series you want to cluster or classify requires a whole new approach.</p>
<p>That explanation will be part of an upcoming blog post.</p>
</div>
</div>
<div id="data-compression" class="section level2">
<h2 class="hasAnchor">
<a href="#data-compression" class="anchor"></a>Data compression</h2>
<p>Data compression is a fascinating discipline with <a href="https://cs.fit.edu/~mmahoney/compression/rationale.html">surprising connections</a> to machine learning.</p>
<p>The field can be described as</p>
<blockquote>
<p>the art or science of representing information in a more compact form. - <em>Sayood, K. Introduction to Data Compression</em></p>
</blockquote>
<p>Compact forms have natural utility in machine learning by way of dimensionality reduction. Principle Component Analysis (PCA) can be thought of as a <a href="http://www.statistics4u.info/fundstat_eng/cc_pca_compress.html">data compression</a> algorithm, as well as a reduction technique.</p>
<p>Both fields also seek correlations<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. In data compression, correlation implies redundant information, and the goal is to reduce the data to the minimum set of uncorrelated data.</p>
<p>This approach is extremely relevant in machine learning, where highly correlated features are much difficult to work with and may even harm accuracy.</p>
<p>I hope this gets you interested in data compression!</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>The material is also applicable to a single <em>multivariate</em> time series.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><em>Introduction to Data Compression</em> example 13.2.1 is a fun look at linear regression as a compression technique.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
